<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Data provenance â€¢ bowerbird</title>
<!-- jquery --><script src="https://code.jquery.com/jquery-3.1.0.min.js" integrity="sha384-nrOSfDHtoPMzJHjVTdCopGqIqeYETSXhZDFyniQ8ZHcVy08QesyHcnOUpMpqnmWq" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script><!-- Font Awesome icons --><link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/1.7.1/clipboard.min.js" integrity="sha384-cV+rhyOuRHc9Ub/91rihWcGmMmCXDeksTtCihMupQHSsi8GIIRDG0ThDc3HGQFJ3" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../jquery.sticky-kit.min.js"></script><script src="../pkgdown.js"></script><meta property="og:title" content="Data provenance">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-vignette">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="../index.html">bowerbird</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/bowerbird.html">Get Started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/data_provenance.html">Data provenance</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/AustralianAntarcticDivision/bowerbird">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9">
    <div class="page-header toc-ignore">
      <h1>Data provenance</h1>
                        <h4 class="author">Ben Raymond, Michael Sumner</h4>
            
            <h4 class="date">2018-02-21</h4>
          </div>

    
    
<div class="contents">
<p>Bowerbird will maintain a local collection of data files, sourced from external data providers. When one does an analysis using such files, it is useful to know <em>which</em> files were used, and the <em>provenance</em> of those files. This information will assist in making analyses reproducible.</p>
<p>Bowerbird actually knows very little about the data files that it maintains, particularly if it is using the <code>bb_handler_wget</code> method. In this case, for a given data source it typically knows the URL and flags to pass to <code>wget</code>, and some basic metadata (primarily intended to be read by the user). This is by design: the heavy lifting involved in mirroring a remote data source is generally handballed to the third-party utility <code>wget</code>. This simplifies both the bowerbird code as well as the process of writing and maintaining data sources.</p>
<p>The downside of this is that bowerbird can’t necessarily answer questions about data provenance in specific detail. Say that we are using data from a data source that contains many separate files, one per day, spanning many years, and we run an analysis that uses only files from the year 1999. Ideally we would like a function that could tell us exactly which files from the complete data set are needed for our particular analysis, but this is impossible without specific knowledge of how the data source is structured. Analogous situations exist with data sources that split geographic space across files, or split different parameters across files.</p>
<p>Despite this, bowerbird can provide some general information to assist with data provenance issues.</p>
<div id="which-files-were-used-in-an-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#which-files-were-used-in-an-analysis" class="anchor"></a>Which files were used in an analysis</h2>
<p>Say we have a bowerbird config:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(bowerbird)
cf &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bb_config.html">bb_config</a></span>(<span class="st">"/some/local/path"</span>) %&gt;%<span class="st"> </span><span class="kw"><a href="../reference/bb_add.html">bb_add</a></span>(<span class="kw"><a href="../reference/bb_example_sources.html">bb_example_sources</a></span>())</code></pre></div>
<p>We can ask bowerbird where these files are stored locally:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">source_dirs &lt;-<span class="st"> </span><span class="kw"><a href="../reference/bb_data_source_dir.html">bb_data_source_dir</a></span>(cf)
knitr::<span class="kw">kable</span>(<span class="kw">data.frame</span>(<span class="dt">name=</span>cf$data_sources$name,<span class="dt">source_dir=</span>source_dirs))</code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">name</th>
<th align="left">source_dir</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NOAA OI SST V2</td>
<td align="left">/some/local/path/ftp.cdc.noaa.gov/Datasets/noaa.oisst.v2</td>
</tr>
<tr class="even">
<td align="left">Australian Election 2016 House of Representatives data</td>
<td align="left">/some/local/path/results.aec.gov.au/20499/Website</td>
</tr>
<tr class="odd">
<td align="left">CMEMS global gridded SSH reprocessed (1993-ongoing)</td>
<td align="left">/some/local/path/ftp.sltac.cls.fr/Core/SEALEVEL_GLO_PHY_L4_REP_OBSERVATIONS_008_047/dataset-duacs-rep-global-merged-allsat-phy-l4-v3</td>
</tr>
<tr class="even">
<td align="left">Oceandata SeaWiFS Level-3 mapped monthly 9km chl-a</td>
<td align="left">/some/local/path/oceandata.sci.gsfc.nasa.gov/SeaWiFS/Mapped</td>
</tr>
<tr class="odd">
<td align="left">Sea Ice Trends and Climatologies from SMMR and SSM/I-SSMIS, Version 2</td>
<td align="left">/some/local/path/daacdata.apps.nsidc.org/pub/DATASETS/nsidc0192_seaice_trends_climo_v2</td>
</tr>
<tr class="even">
<td align="left">Bathymetry of Lake Superior</td>
<td align="left">/some/local/path/www.ngdc.noaa.gov/mgg/greatlakes/superior/data</td>
</tr>
</tbody>
</table>
<p>The directory for each data source will contain <em>all</em> of the files associated with that data source, not just the files used in a particular analysis. (In extreme cases this directory might even contain files from other data sources, although this should only happen if multiple data sources have overlapping <code>source_url</code> paths, which ought not to be a common occurrence.)</p>
<p>So while this directory is not the <em>minimal</em> set of files needed to reproduce an analysis, it does at least contain that set, and could be used to store those files in an online repository that assigns DOIs (such as figshare, see <a href="https://cran.r-project.org/package=rfigshare" class="uri">https://cran.r-project.org/package=rfigshare</a>, or zenodo), or bundle into a docker image (see e.g <a href="https://github.com/o2r-project/containerit" class="uri">https://github.com/o2r-project/containerit</a>).</p>
<p>The complete list of files within a data source’s directory can be generated using a standard directory listing (e.g. <code>list.files(path=my_source_dir,recursive=TRUE</code>), but see also the <code>bb_fingerprint</code> function described below, which provides additional information about the files.</p>
<div id="refining-the-list-of-files" class="section level3">
<h3 class="hasAnchor">
<a href="#refining-the-list-of-files" class="anchor"></a>Refining the list of files</h3>
<p>Ascertaining exactly which files were used in a particular analysis is a task that is better handled by the code being used to do the file-reading and analysis, not by the repository-management (bowerbird) code.</p>
<p>We are unaware of any general solutions that will keep track of the files used by an arbitrary chunk of R code.</p>
<p>The recordr package (<a href="https://github.com/NCEAS/recordr" class="uri">https://github.com/NCEAS/recordr</a>) comes close: it will collect info about which files were read or written. However, this only works for file types that have read functions implemented in recordr. At the time of writing, this does not cover netcdf files or other files typically used for environmental data, and so its application in that domain is likely to be of limited value.</p>
<p>Packages that provide specific data access functionality (e.g. <a href="https://github.com/AustralianAntarcticDivision/raadtools" class="uri">https://github.com/AustralianAntarcticDivision/raadtools</a>) might provide mechanisms for tracking which data files are needed in order to fulfil particular data queries.</p>
</div>
</div>
<div id="the-provenance-of-files-used-in-an-analysis" class="section level2">
<h2 class="hasAnchor">
<a href="#the-provenance-of-files-used-in-an-analysis" class="anchor"></a>The provenance of files used in an analysis</h2>
<p>Provenance: where the files came from, when they were downloaded, their version, etc.</p>
<p>The <code>bb_fingerprint</code> function, given a data repository configuration, will return the timestamp of download and hashes of all files associated with its data sources. Thus, for all of these files, we have established where they came from (the data source ID), when they were downloaded, and a hash so that later versions of those files can be compared to detect changes.</p>
<div id="a-word-on-digital-object-identifiers" class="section level3">
<h3 class="hasAnchor">
<a href="#a-word-on-digital-object-identifiers" class="anchor"></a>A word on digital object identifiers</h3>
<p>When a data source is defined, it should have used its DOI as its data source ID (if it has a DOI, otherwise some other unique identifier). The idea of a DOI is that a data set that has a DOI should be peristent (accessible for long term use), and the DOI should uniquely identify the data resource that it is assigned to. When a data set changes in a substantial manner, and/or it is necessary to identify both the original and the changed material, a new DOI should be assigned. Thus, knowing the DOI gives some indication of the data provenance.</p>
<p>However, it is worth noting that the DOI might not uniquely identify the state of the data source. For example, the NSIDC SMMR-SSM/I Nasateam near-real-time sea ice concentration data set (DOI <a href="http://doi.org/10.5067/U8C09DWVX9LM" class="uri">http://doi.org/10.5067/U8C09DWVX9LM</a>) is updated each day (new files are added) as new data is acquired by the satellites. At periodic intervals, these files are subjected to more rigorous quality control and post-processing, and then moved into a different data set (<a href="http://doi.org/10.5067/8GQ8LZQVL0VL" class="uri">http://doi.org/10.5067/8GQ8LZQVL0VL</a>). Thus, knowing the DOI of the near-real-time data set does not uniquely identify the files that were included in that data set at a given point in time.</p>
<p>Similar ambiguity can arise for other reasons, including data corrections. Say that one data file within a large collection was found to have errors and was corrected: it is at the discretion of the data provider whether the data set as a whole receives a new DOI because of this change.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#which-files-were-used-in-an-analysis">Which files were used in an analysis</a></li>
      <li><a href="#the-provenance-of-files-used-in-an-analysis">The provenance of files used in an analysis</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by Ben Raymond, Michael Sumner.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="http://pkgdown.r-lib.org/">pkgdown</a>.</p>
</div>

      </footer>
</div>

  </body>
</html>
